<!DOCTYPE html>
<html>
<head>
    <title>Profile Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Profile Debug Test</h1>
        <p>User: {{ user.username }} ({{ user.email }})</p>
        
        <!-- Display Django messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        <div class="row">
            <div class="col-md-6">
                <h3>Current User Data</h3>
                <ul>
                    <li><strong>Identity:</strong> {{ user.first_name|default:"None" }} {{ user.last_name|default:"None" }}</li>
                    <li><strong>Phone:</strong> {{ user.phone_number|default:"None" }}</li>
                    <li><strong>Address:</strong> {{ user.address|default:"None" }}</li>
                    <li><strong>Location:</strong> {{ user.city|default:"None" }}, {{ user.county|default:"None" }}, {{ user.country|default:"None" }}</li>
                    <li><strong>Occupation:</strong> {{ user.occupation|default:"None" }}</li>
                    <li><strong>Employer:</strong> {{ user.employer_name|default:"None" }}</li>
                    <li><strong>Monthly Income:</strong> KES {{ user.monthly_income|default:"None" }}</li>
                    <li><strong>Employment Duration:</strong> {{ user.employment_duration|default:"None" }} months</li>
                    <li><strong>Emergency Contact:</strong> {{ user.emergency_contact_name|default:"None" }} ({{ user.emergency_contact_relationship|default:"None" }})</li>
                    <li><strong>Emergency Phone:</strong> {{ user.emergency_contact_phone|default:"None" }}</li>
                </ul>
            </div>
            
            <div class="col-md-6">
                <h3>Test Forms</h3>
                
                <!-- Identity Form Test -->
                <div class="card mb-3">
                    <div class="card-header">Identity Form Test</div>
                    <div class="card-body">
                        <form method="POST" action="{% url 'dashboard:test_form_save' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="identity">
                            <div class="mb-2">
                                <label>First Name:</label>
                                <input type="text" name="first_name" class="form-control" value="{{ user.first_name }}">
                            </div>
                            <div class="mb-2">
                                <label>Last Name:</label>
                                <input type="text" name="last_name" class="form-control" value="{{ user.last_name }}">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Identity</button>
                        </form>
                    </div>
                </div>
                
                <!-- Contact Form Test -->
                <div class="card mb-3">
                    <div class="card-header">Contact Form Test</div>
                    <div class="card-body">
                        <form method="POST" action="{% url 'dashboard:test_form_save' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="contact">
                            <div class="mb-2">
                                <label>Phone Number:</label>
                                <input type="text" name="phone_number" class="form-control" value="{{ user.phone_number }}">
                            </div>
                            <div class="mb-2">
                                <label>Address:</label>
                                <textarea name="address" class="form-control">{{ user.address }}</textarea>
                            </div>
                            <div class="mb-2">
                                <label>City:</label>
                                <input type="text" name="city" class="form-control" value="{{ user.city }}">
                            </div>
                            <div class="mb-2">
                                <label>County:</label>
                                <input type="text" name="county" class="form-control" value="{{ user.county }}">
                            </div>
                            <div class="mb-2">
                                <label>Country:</label>
                                <input type="text" name="country" class="form-control" value="{{ user.country|default:"Kenya" }}">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Contact</button>
                        </form>
                    </div>
                </div>
                
                <!-- Employment Form Test -->
                <div class="card mb-3">
                    <div class="card-header">Employment Form Test</div>
                    <div class="card-body">
                        <form method="POST" action="{% url 'dashboard:test_form_save' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="employment">
                            <div class="mb-2">
                                <label>Occupation:</label>
                                <input type="text" name="occupation" class="form-control" value="{{ user.occupation }}">
                            </div>
                            <div class="mb-2">
                                <label>Employer Name:</label>
                                <input type="text" name="employer_name" class="form-control" value="{{ user.employer_name }}">
                            </div>
                            <div class="mb-2">
                                <label>Monthly Income:</label>
                                <input type="number" name="monthly_income" class="form-control" value="{{ user.monthly_income }}">
                            </div>
                            <div class="mb-2">
                                <label>Employment Duration (months):</label>
                                <input type="number" name="employment_duration" class="form-control" value="{{ user.employment_duration }}">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Employment</button>
                        </form>
                    </div>
                </div>
                
                <!-- Emergency Form Test -->
                <div class="card mb-3">
                    <div class="card-header">Emergency Contact Form Test</div>
                    <div class="card-body">
                        <form method="POST" action="{% url 'dashboard:test_form_save' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="emergency">
                            <div class="mb-2">
                                <label>Emergency Contact Name:</label>
                                <input type="text" name="emergency_contact_name" class="form-control" value="{{ user.emergency_contact_name }}">
                            </div>
                            <div class="mb-2">
                                <label>Emergency Contact Phone:</label>
                                <input type="text" name="emergency_contact_phone" class="form-control" value="{{ user.emergency_contact_phone }}">
                            </div>
                            <div class="mb-2">
                                <label>Emergency Contact Relationship:</label>
                                <input type="text" name="emergency_contact_relationship" class="form-control" value="{{ user.emergency_contact_relationship }}">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Emergency Contact</button>
                        </form>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <strong>Instructions:</strong>
                    <ol>
                        <li>Note the current values above</li>
                        <li>Modify values in the forms below</li>
                        <li>Submit the forms</li>
                        <li>Refresh the page to see if changes persist</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <a href="{% url 'dashboard:profile' %}" class="btn btn-secondary">Back to Profile</a>
            <a href="{% url 'dashboard:dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
    
    <script>
        // Add some debugging
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                console.log('Form submitted:', this.action);
                console.log('Form data:', new FormData(this));
            });
        });
    </script>
</body>
</html>
